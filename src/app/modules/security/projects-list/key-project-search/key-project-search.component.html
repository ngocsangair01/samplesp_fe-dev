<div id="searchPage">
    <div id="searchArea">
        <div class="panel panel-default">
            <div class="panel-heading">
                <strong class="text-u-c">
                    <i class="fa fa-th"></i>
                    {{'protectsecurity.mainproject.label.title' | translate}}
                </strong>
            </div>
            <form id="formSearch" [formGroup]="formSearch">
                <div class="panel-body padding-xl ui-g">
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.mda' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <input type="text" class="form form-control" name="code" formControlName="code"
                                   maxlength="20" [autoFocus]="true">
                            <app-control-messages [control]="f['code']"></app-control-messages>
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.tda' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <input type="text" class="form form-control" name="name" formControlName="name"
                                   maxlength="255">
                            <app-control-messages [control]="f['name']"></app-control-messages>
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.dvct' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <org-selector
                                    [property]="f['organizationId']"
                                    operationKey="action.view"
                                    adResourceKey="resource.keyProject"
                                    [defaultValue]="true">
                            </org-selector>
                            <app-control-messages [control]="f['organizationId']"></app-control-messages>
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.plda' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <select-filter
                                    [property]="f['type']"
                                    [options]="listKeyProjectType"
                                    optionLabel="label"
                                    optionValue="value"
                                    [placeHolder]="'common.label.cboSelectAll'">
                            </select-filter>
                            <app-control-messages [control]="f['type']"></app-control-messages>
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.tt' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <select-filter
                                    [property]="f['status']"
                                    [options]="statusList"
                                    optionLabel="label"
                                    optionValue="value"
                                    [placeHolder]="'common.label.cboSelectAll'">
                            </select-filter>
                            <app-control-messages [control]="f['status']"></app-control-messages>
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.nbdtn' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <date-picker
                                    [property]="f['startDate']">
                            </date-picker>
                            <app-control-messages [control]="f['startDate']"></app-control-messages>
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.nbddn' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <date-picker [property]="f['toStartDate']">
                            </date-picker>
                            <app-control-messages [control]="f['toStartDate']"></app-control-messages>
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.nkttn' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <date-picker
                                    [property]="f['endDate']">
                            </date-picker>
                            <app-control-messages [control]="f['endDate']"></app-control-messages>
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                            {{'protectsecurity.mainproject.label.nktdn' | translate}}
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3">
                            <date-picker [property]="f['toEndDate']">
                            </date-picker>
                            <app-control-messages [control]="f['toEndDate']"></app-control-messages>
                        </div>
                    </div>

                </div>
                <div class="panel-footer vt-area-button">
                    <button type="submit" class="btn btn-sm btn-info" *ngIf="hasPermission('action.view')"
                            (click)="processSearch()" [innerHTML]="'common.button.icon.search' | translate"></button>
                    <button type="button" class="btn btn-sm btn-info" *ngIf="hasPermission('action.insert')"
                            (click)="prepareSaveOrUpdate()"
                            [innerHTML]="'common.button.icon.addNew' | translate"></button>
                    <button type="button" class="btn btn-sm btn-info" *ngIf="hasPermission('action.export')"
                            (click)="processExport()"
                            [innerHTML]="'common.button.icon.exportFile' | translate"></button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="listArea">
    <div class="panel panel-default">
        <div class="panel-heading vt-relative">
            <strong class="text-u-c">
                <i class="fa fa-th"></i> {{'protectsecurity.mainproject.table.title' | translate}}
            </strong>
        </div>
        <div class="panel-body panel-table">
            <p-table
                #ptable
                [value]="resultList.data"
                [paginator]="true"
                (onLazyLoad)="processSearch($event)"
                [lazy]="true" [rows]="changeRow"
                [totalRecords]="resultList.recordsTotal"
                [scrollable]="true"
                [lazyLoadOnInit]="false"
                tableStyleClass="table table-wrapper table-hover table-striped b-t b-b"
                styleClass="controlOverflow">
                <ng-template pTemplate="colgroup" let-columns>
                    <colgroup>
                        <col class="size-1">
                        <col class="size-5">
                        <col class="size-6">
                        <col class="size-7">
                        <col class="size-12">
                        <col class="size-4">
                        <col class="size-4">
                        <col class="size-4">
                        <col class="size-8">
                        <col class="size-10">
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th>{{'common.table.index' | translate}}</th>
                        <th>{{'common.label.action' | translate}}</th>
                        <th [pSortableColumn]="'code'">
                            {{'protectsecurity.mainproject.label.mda' | translate}}
                            <p-sortIcon [field]="'code'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'name'">
                            {{'protectsecurity.mainproject.label.tda' | translate}}
                            <p-sortIcon [field]="'name'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'organizationName'">
                            {{'protectsecurity.mainproject.label.dvct' | translate}}
                            <p-sortIcon [field]="'organizationName'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'startDate'">
                            {{'protectsecurity.mainproject.label.nbd' | translate}}
                            <p-sortIcon [field]="'startDate'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'endDate'">
                            {{'protectsecurity.mainproject.label.nkt' | translate}}
                            <p-sortIcon [field]="'endDate'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'type'">
                            {{'protectsecurity.mainproject.label.plda' | translate}}
                            <p-sortIcon [field]="'type'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'status'">
                            {{'protectsecurity.mainproject.label.tt' | translate}}
                            <p-sortIcon [field]="'status'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'reason'">
                            {{'protectsecurity.mainproject.table.ldtc' | translate}}
                            <p-sortIcon [field]="'reason'"></p-sortIcon>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item let-index="rowIndex+1">
                    <tr>
                        <td class="vt-align-center">{{index}}</td>
                        <td class="vt-align-center" style="overflow: initial !important;">
                            <div ngbDropdown class="d-inline-block">
                                <button class="btn btn-sm btn-info" ngbDropdownToggle translate>common.label.action
                                </button>
                                <div ngbDropdownMenu>
                                    <!--sua-->
                                    <div *ngIf="hasPermission('action.update') && item.status === 1 || item.status === 3">
                                        <button class="dropdown-item" (click)="prepareSaveOrUpdate(item)"
                                                [innerHTML]="'common.button.table.acteditdropdown' | translate">
                                        </button>
                                    </div>
                                    <!--xoa-->
                                    <div *ngIf="hasPermission('action.delete') && item.status === 1 || item.status === 3">
                                        <button class="dropdown-item" (click)="processDelete(item)"
                                                [innerHTML]="'common.button.removedropdown' | translate">
                                        </button>
                                    </div>
                                    <!--Phe duyet-->
                                    <div *ngIf="hasPermission('action.approval') && item.status === 1">
                                        <button class="dropdown-item" (click)="actionApproved(item)"
                                                [innerHTML]="'common.button.table.actApprove' | translate">
                                        </button>
                                    </div>
                                    <!--Huy Du An-->
                                    <div *ngIf="hasPermission('action.approval') && item.status === 2">
                                        <button class="dropdown-item" (click)="actionCancel(item)"
                                                [innerHTML]="'common.button.icon.cancel' | translate">
                                        </button>
                                    </div>
                                    <!-- tu choi -->
                                    <div *ngIf="hasPermission('action.approval') && item.status === 1">
                                        <button class="dropdown-item" (click)="actionUnApproved(item)"
                                                [innerHTML]="'common.button.table.actUnapproved' | translate">
                                        </button>
                                    </div>
                                    <!--View-->
                                    <div *ngIf="hasPermission('action.view')">
                                        <button class="dropdown-item" (click)="processView(item, true)"
                                                [innerHTML]="'common.button.table.viewdropdown' | translate">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="vt-align-center">
                            {{item.code}}
                        </td>
                        <td class="vt-align-left">
                            {{item.name}}
                        </td>
                        <td class="vt-align-left">{{item.organizationName}}</td>
                        <td class="vt-align-center">
                            {{item.startDate | displayDate}}
                        </td>
                        <td class="vt-align-center">
                            {{item.endDate | displayDate}}
                        </td>
                        <td class="vt-align-left">
                            <span *ngIf="item.type === 1">Dân sự</span>
                            <span *ngIf="item.type === 2">Quân sự</span>
                        </td>
                        <td class="vt-align-left">
                            <span class="label-status notYet" *ngIf="item.status === 1">Đơn vị mới tạo</span>
                            <span class="label-status info" *ngIf="item.status === 2">Đã phê duyệt</span>
                            <span class="label-status danger" *ngIf="item.status === 3">Từ chối</span>
                            <span class="label-status danger" *ngIf="item.status === 4">Đã hủy</span>
                        </td>
                        <td class="vt-align-left">
                            {{item.reason}}
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr class="emptymessage">
                        <td [attr.colspan]="10" [innerHTML]="'app.noRecords' | translate">
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="paginatorleft">
                    <table-footer (changeRow)="onTablePageChange($event)" [resultList]="resultList"></table-footer>
                </ng-template>
            </p-table>
        </div>
    </div>

</div>
