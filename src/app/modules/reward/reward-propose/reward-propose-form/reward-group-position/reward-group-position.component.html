<div id="header-search" style="margin-right: 0.75rem; display: flex; justify-content: flex-end;">
  <div class="vt-relative">
    <form [formGroup]="formSearchNguoiHuong">
      <div class="display-table" style="border: 1px solid rgba(246,183,109,0.6); border-radius: 8px; overflow: hidden;">
        <div class="table-cell">
          <button type="submit" class="icon-search input-search" (click)="filterFormSubsidizedSuggest()">
            <i class="fa fa-search" aria-hidden="true"></i>
          </button>
        </div>
        <div class="table-cell">
          <input type="text" class="form-control input-search no-between-border" name="keyword"
            formControlName="keyword" placeholder="{{'home.search.placeHolder' | translate}}"
            appendTo="body">
        </div>
      </div>
    </form>
  </div>
</div>
<form id="formSave" [formGroup]="formRewardGroup">
  <div class="panel-body panel-table" style="padding: 12px;">
    <p-table [scrollable]="true" [value]="formRewardGroup.controls" [paginator]="true" (onPage)="updateChooseAll(formRewardGroup.controls)"
    [(first)]="firstRowIndex" [rows]="pageSize"  [totalRecords]="formRewardGroup.controls.length" [resizableColumns]="true" [scrollable]="true"
      tableStyleClass="table table-wrapper table-hover table-striped b-t b-b">
      <div class="tbl-panel">
        <ng-template pTemplate="colgroup" let-columns>
          <colgroup>
            <col style="width: 50px;">
            <col *ngIf="!isView && !isEditSelection && !isViewSelection && isSynthetic != 1 && !isAddSign && !isEditSign && !isViewSign && !isDisable" style="width: 100px;">
            <col *ngIf="isViewFile" style="width: 100px;">
            <col style="width: 200px;">
            <col style="width: 250px;">
            <col style="width: 200px;">
            <col style="width: 100px;">
            <col style="width: 100px;">
            <col *ngIf="isEditSelection || isViewSelection" style="width: 100px;">
            <col *ngIf="isEditSelection || isViewSelection" style="width: 100px;">
            <col *ngIf="isEditSelection || isViewSelection" style="width: 100px;">
            <col *ngIf="isHideProposeSign" style="width: 100px;">
            <col *ngIf="isHideProposeSign" style="width: 100px;">
            <col *ngIf="isHideProposeSign" style="width: 100px;">
            <col *ngIf="isHideProposeSign" style="width: 100px;">
            <col style="width: 100px;">
            <col style="width: 100px;">
            <col style="width: 200px;">
            <col *ngIf="isHideProposeSign" style="width: 150px;">
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pResizableColumn translate>common.table.index</th>
            <th pResizableColumn translate *ngIf="!isView && !isEditSelection && !isViewSelection && isSynthetic != 1 && !isAddSign && !isEditSign && !isViewSign && !isDisable">
              <span>common.label.action</span>
            </th>
            <!-- check all -->
            <th pResizableColumn translate *ngIf="isViewFile">
              <span>common.button.chose</span>
              <div class="check">
                <input type="checkbox" (change)="chooseAll($event, formRewardGroup.controls, 3)" #elePreviewAll style="width: 18px; height: 1.5rem;">
              </div>
            </th>
            <!-- to chuc duoc khen thuong -->
            <th pResizableColumn translate><span [ngClass]="'required'">tabRewardGroup.rewardProposal.rewardGroupName</span></th>
            <!-- Loai danh hieu khen thuong -->
            <th pResizableColumn translate><span>label.commendations.type</span></th>
            <!-- danh hieu/hinh thuc -->
            <th pResizableColumn translate><span [ngClass]="'required'">rewardGeneral.rewardTitle</span></th>
            <!-- tien thuong -->
            <th pResizableColumn translate>rewardGeneral.money</th>
            <!-- noi dung khen thuong -->
            <th pResizableColumn translate>rewardGeneral.content</th>
            <!-- Xét chọn -->
            <th pResizableColumn translate *ngIf="isEditSelection || isViewSelection">
              <span>label.rewardPropose.isChoose
              </span>
              <div class="check">
                <input type="checkbox" (change)="chooseAll($event, formRewardGroup.controls, 1)" #eleChooseAll [attr.disabled]="isViewSelection ? true: null" style="width: 18px; height: 1.5rem;" >
              </div>
            </th>
            <!-- Đề xuất lên -->
            <th pResizableColumn translate *ngIf="isEditSelection || isViewSelection">
              <span>label.rewardPropose.isSuggest</span>
              <div class="check">
                <input type="checkbox" (change)="chooseAll($event, formRewardGroup.controls, 2)" #eleSuggestAll [attr.disabled]="isViewSelection ? true: null" style="width: 18px; height: 1.5rem;">
              </div>
            </th>
            <!-- lý do -->
            <th pResizableColumn translate *ngIf="isEditSelection || isViewSelection"><span>label.rewardPropose.note</span></th>
            <th pResizableColumn translate *ngIf="isHideProposeSign">label.rewardPropose.accountNumber</th>
            <th pResizableColumn translate *ngIf="isHideProposeSign">label.rewardPropose.bank</th>
            <th pResizableColumn translate *ngIf="isHideProposeSign">label.rewardPropose.accountName</th>
            <th pResizableColumn translate *ngIf="isHideProposeSign">label.rewardPropose.reimbursementOrganization</th>
            <th pResizableColumn translate >label.rewardPropose.representative</th>
            <th pResizableColumn translate >label.rewardPropose.representativeName</th>
            <th pResizableColumn translate><span>rewardGeneral.receiveBonusOrgName</span></th>
            <th pResizableColumn translate *ngIf="isHideProposeSign"><span>label.rewardPropose.group.partnerDrCode</span></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item let-index="rowIndex">
          <tr [formGroup]="item" [ngClass]="{'d-none': item.controls.isHidden.value}">
            <td class="vt-align-center">
              {{index+1}}
            </td>
            <td class="vt-align-center" *ngIf="!isView && !isEditSelection && !isViewSelection && isSynthetic != 1 && !isAddSign && !isEditSign && !isViewSign && !isDisable">
              <button class="btn-icon minus" type="button" (click)="remove(index, item)"
                [innerHTML]="'common.icon.minus' | translate">
                <span class="glyphicons glyphicons-minus icon-table delete" title="Xóa"></span>
              </button>
            </td>
            <td class="vt-align-left" *ngIf="isViewFile">
              <input type="checkbox" class="ui-chkbox ui-chkbox-box" style="height: 1.5rem;" name="isPreview" [value]="0"
                formControlName="isPreview" (change)="onChangeChooseOrSuggest(item, formRewardGroup.controls)" />
            </td>
            <td>
              <!-- Phụ nữ, thanh niên, đoàn -->
              <mass-org-selector *ngIf="isMasO && (!isEditSelection && !isViewSelection && !isView && !isAddSign && !isViewSign && !isEditSign)" [property]="item.controls.massOrganizationId" operationKey="action.view"
                adResourceKey="resource.rewardPropose" [defaultValue]="false" [branch]="branch" [rootId]="rootMassID"
                [disabled]="isView || isEditSelection || isViewSelection || isSynthetic == 1 || isAddSign || isEditSign || isViewSign || isDisable ? true: null" [autoFocus]="true" [isRequiredField]="true"
                (onChange)="onChangeMassOrg($event, massOrgSelector)" [title]="item.value.massOrgName || ''" #massOrgSelector>
              </mass-org-selector>
              <input *ngIf="isMasO && (isEditSelection || isViewSelection || isView || isAddSign || isViewSign || isEditSign)"
                type="text" class="form form-control" name="massOrgName" disabled="true" formControlName="massOrgName"
                [title]="item.controls.massOrgName.value  || ('')" />

              <mass-org-selector *ngIf="isSelectedRewardType && (!isEditSelection && !isViewSelection && !isView && !isAddSign && !isViewSign && !isEditSign)" [property]="item.controls.massOrganizationId"
                operationKey="action.view" adResourceKey="resource.rewardPropose" [defaultValue]="false" [branch]="branch"
                [disabled]="true" [autoFocus]="true" [isRequiredField]="true" [rootId]="rootMassID"
                (onChange)="onChangeMassOrg($event, massOrgSelector)" #massOrgSelector>
              </mass-org-selector>
              <input *ngIf="isSelectedRewardType && (isEditSelection || isViewSelection || isView || isAddSign || isViewSign || isEditSign)"
                type="text" class="form form-control" name="massOrgName" disabled="true" formControlName="massOrgName"
                [title]="item.controls.massOrgName.value  || ('')" />
              <app-control-messages *ngIf="isMasO" [control]="item.controls.massOrganizationId"></app-control-messages>

              <!-- Đảng -->
              <party-org-selector [property]="item.controls.partyOrganizationId" *ngIf="isOgr && (!isEditSelection && !isViewSelection && !isView && !isAddSign && !isViewSign && !isEditSign)"
                operationKey="action.view" adResourceKey="resource.rewardPropose" [isRequiredField]="true"
                [defaultValue]="false" (onChange)="onChangeMassOrg($event)" [title]="item.value.partyOrgName || ''" [rootId]="rootMassID"
                [disabled]="isView || isEditSelection || isViewSelection || isSynthetic == 1 || isAddSign || isEditSign || isViewSign || isDisable ? true: null" #partyOrgSelector>
              </party-org-selector>
              <input *ngIf="isOgr && (isEditSelection || isViewSelection || isView || isAddSign || isViewSign || isEditSign)"
                type="text" class="form form-control" name="partyOrgName" disabled="true" formControlName="partyOrgName"
                [title]="item.controls.partyOrgName.value  || ('')" />
              <app-control-messages *ngIf="isOgr" [control]="item.controls.partyOrganizationId"></app-control-messages>

              <!-- Chính quyền -->
              <org-selector *ngIf="isGOV && (!isEditSelection && !isViewSelection && !isView && !isAddSign && !isViewSign && !isEditSign)" [property]="item.controls.organizationId" operationKey="action.view"
                adResourceKey="resource.rewardPropose" [defaultValue]="false" (onChange)="onChangeMassOrg($event)" [title]="item.value.orgName || ''" [rootId]="rootID"
                [disabled]="isView || isEditSelection || isViewSelection || isSynthetic == 1 || isAddSign || isEditSign || isViewSign || isDisable ? true: null" isRequiredField=true;>
              </org-selector>
              <input *ngIf="isGOV && (isEditSelection || isViewSelection || isView || isAddSign || isViewSign || isEditSign)"
                type="text" class="form form-control" name="orgName" disabled="true" formControlName="orgName"
                [title]="item.controls.orgName.value  || ('')" />
              <app-control-messages *ngIf="isGOV" [control]="item.controls.organizationId"></app-control-messages>
            </td>

            <!-- Loại danh hiệu khen thưởng -->
            <td>
              <div class="text-left">
                <div class="form-check-inline">
                  <label class="i-checks">
                    <input [attr.disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null"
                           type="radio" class="form-check-input control-label" id="rewardCategory{{index}}_1" value="1"
                           (change)="isEnableReceiveBonusOrgCheck(item)"
                           formControlName="rewardCategory">
                    <i></i>
                    {{'rewardCategory.titleReward' | translate}}
                  </label>
                </div>
                <div class="form-check-inline">
                  <label class="i-checks">
                    <input [attr.disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null"
                           type="radio" class="form-check-input control-label" id="rewardCategory{{index}}_2" value="2"
                           (change)="isEnableReceiveBonusOrgCheck(item)"
                           formControlName="rewardCategory">
                    <i></i>
                    {{'rewardCategory.formReward' | translate}}
                  </label>
                </div>
<!--                <div class="form-check-inline">-->
<!--                  <label class="i-checks">-->
<!--                    <input [attr.disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null" type="radio" class="form-check-input control-label" id="rewardCategory{{index}}_3" value="3" formControlName="rewardCategory">-->
<!--                    <i></i>-->
<!--                    {{'rewardCategory.otherReward' | translate}}-->
<!--                  </label>-->
<!--                </div>-->
              </div>
            </td>
            <!-- Danh hiệu, hình thức khen thưởng -->
            <td>
              <select-icon-filter [property]="item.controls.rewardTitleId" [options]="mapRewardTitleIdList[rewardType][item.controls.rewardCategory.value]" optionLabel="name"
                optionValue="rewardCategoryId" [placeHolder]="'common.label.cboMustSelect'" appendTo="body"
                [disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign"
                [rewardGroupType]="rewardTitleIdList" (onChange)="getAmountOfMoney(item)" [title]="item.controls.rewardTitleId.value ? item.controls.rewardTitleName.value : ''">
              </select-icon-filter>
              <app-control-messages [control]="item.controls.rewardTitleId"></app-control-messages>
            </td>
            <!-- Số tiền khen thưởng -->
            <td class="vt-align-right">
              <input *ngIf="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null" type="text" style="text-align:right;" class="form form-control" name="amountOfMoney" min="0"
                formControlName="amountOfMoney" maxlength="15" [value]="item.value.amountOfMoney | currency: 'VND'"
                [attr.disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null">
              <input *ngIf="isView || isViewSelection || isAddSign || isEditSign || isViewSign? null: true" type="text" style="text-align:right;" class="form form-control" name="amountOfMoney" min="0"
                     formControlName="amountOfMoney" maxlength="15"
                     [attr.disabled]="isView || isViewSelection || isAddSign || isEditSign || isViewSign? true: null">
              <app-control-messages [control]="item.controls.amountOfMoney"></app-control-messages>
            </td>
            <!-- Nội dung khen thưởng -->
            <td class="vt-align-center">
              <textarea type="text" rows="2" name="description" class="form-control" formControlName="description" [title]="item.controls.description.value || ''"
                maxlength="2000" [attr.disabled]="isView || isViewSelection || isViewSign? true: null">
            </textarea>
              <app-control-messages [control]="item.controls.description"></app-control-messages>
            </td>
            <!-- Xét chọn-->
            <td class="vt-align-left" *ngIf="isEditSelection || isViewSelection">
              <input type="checkbox" class="ui-chkbox ui-chkbox-box" style="height: 1.5rem;" name="isChoose" [value]="0"
              formControlName="isChoose" [attr.disabled]="isViewSelection ? true: null" (change)="onChangeChooseOrSuggest(item, formRewardGroup.controls)"/>
            </td>
            <!-- Từ chối -->
            <td class="vt-align-left" *ngIf="isEditSelection || isViewSelection">
              <input type="checkbox" class="ui-chkbox ui-chkbox-box" style="height: 1.5rem;" name="isSuggest"
              [value]="0" formControlName="isSuggest" [attr.disabled]="isViewSelection ? true: null" (change)="onChangeChooseOrSuggest(item, formRewardGroup.controls)" />
            </td>
            <!-- lý do từ chối -->
            <td class="vt-align-center" *ngIf="isEditSelection || isViewSelection" [title]="item.controls.reason.value || ''">
              <textarea [autoFocus]="true" type="text" rows="2" name="reason" class="form-control" formControlName="reason"
                maxlength="2000" [attr.disabled]="isViewSelection ? true: null">
              </textarea>
              <app-control-messages [control]="item.controls.reason"></app-control-messages>
            </td>
            <td *ngIf="isHideProposeSign" class="vt-align-center"  [title]="item.controls.accountNumber.value || ''">
              <textarea [autoFocus]="true" type="text" rows="2" name="accountNumber" class="form-control" formControlName="accountNumber"
                        maxlength="2000" [attr.disabled]="true">
              </textarea>
              <app-control-messages [control]="item.controls.accountNumber"></app-control-messages>
            </td>
            <td *ngIf="isHideProposeSign" class="vt-align-center"  [title]="item.controls.accountNumber.bank || ''">
              <textarea [autoFocus]="true" type="text" rows="2" name="bank" class="form-control" formControlName="bank"
                        maxlength="2000" [attr.disabled]="true">
              </textarea>
              <app-control-messages [control]="item.controls.bank"></app-control-messages>
            </td>
            <td *ngIf="isHideProposeSign" class="vt-align-center">
              <textarea [autoFocus]="true" type="text" rows="2" name="accountName" class="form-control" formControlName="accountName"
                                      maxlength="2000" [attr.disabled]="true">
              </textarea>
              <app-control-messages [control]="item.controls.accountName"></app-control-messages>
            </td>
            <td *ngIf="isHideProposeSign" class="vt-align-center">
              <textarea [autoFocus]="true" type="text" rows="2" name="reimbursementOrgName" class="form-control" formControlName="reimbursementOrgName"
                                      maxlength="2000" [attr.disabled]="true">
              </textarea>
              <app-control-messages [control]="item.controls.reimbursementOrgName"></app-control-messages>
            </td>
            <td>
              <data-picker  [property]="item.controls.representativeId" systemCode="political" operationKey="action.view"
                           adResourceKey="resource.rewardPropose" objectBO="AllEmployeeBO" codeField="employeeCode" nameField="fullName"
                           emailField="email" mobileNumberField="mobileNumber" selectField="employeeId"
                           isDisplayCode="true" (onChange)="onChangeEmployee($event)"
                            [disabled]="isView || isEditSelection || isViewSelection || isSynthetic == 1 || isAddSign || isEditSign || isViewSign || isDisable || !item.controls.isEnableReceiveBonusOrg ? true: null">
              </data-picker>
              <app-control-messages [control]="item.controls.representativeId"></app-control-messages>
            </td>
            <td class="vt-align-left">
              <input type="text" class="form form-control" name="employeeName" disabled formControlName="representativeName" [title]="item.controls.representativeName.value  || ''">
              <app-control-messages [control]="item.controls.representativeName"></app-control-messages>
            </td>

            <td class="vt-align-center">
              <org-selector [property]="item.controls.receiveBonusOrgId" operationKey="action.view" [rootId]="rootID"
                            adResourceKey="resource.rewardPropose" [defaultValue]="false" (onChange)="onProposeOrgChange($event)" [title]="item.value.orgName || ''"
                            [disabled]="isView || isViewSelection || isAddSign || isEditSelection || isEditSign || isViewSign || item.controls.isEnableReceiveBonusOrg? true: null" isRequiredField=true;>
              </org-selector>
              <app-control-messages [control]="item.controls.receiveBonusOrgId"></app-control-messages>
            </td>
            <td class="vt-align-left" *ngIf="isHideProposeSign">
              <input type="text" class="form form-control" name="partnerDrCode" disabled formControlName="partnerDrCode" [title]="item.controls.partnerDrCode.value  || ''">
              <app-control-messages [control]="item.controls.partnerDrCode"></app-control-messages>
            </td>
          </tr>
        </ng-template>
      </div>
    </p-table>
  </div>
</form>
<button *ngIf="!isView && !isEditSelection && !isViewSelection && isSynthetic != 1 && !isAddSign && !isEditSign && !isViewSign && !isDisable" class="btn btn-sm vt-btn btn-submit mt-btn ng-star-inserted" type="button" (click)="add()" [innerHTML]="'common.button.icon.addColumn' | translate">
</button>
