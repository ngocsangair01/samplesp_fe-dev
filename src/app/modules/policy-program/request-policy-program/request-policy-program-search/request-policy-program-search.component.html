<div id="searchPage">
  <div id="searchArea">
    <div class="panel panel-default">
      <div class="panel-heading" translate>
        <strong class="text-u-c">
          <i class="fa fa-th"></i>
          common.label.search.info
        </strong>
      </div>
      <form id="formSearch" [formGroup]="formSearch">
        <div class="panel-body padding-xl ui-g">
        <div class="ui-g-12 vt-row">
           <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
            {{'app.requestResolutionMonth.name' | translate}}
            </label>
            <div class="ui-g-12 ui-md-6 ui-lg-3">
              <input type="text" class="form form-control" name="name" formControlName="name" [autoFocus]="true" maxlength="200">
              <app-control-messages [control]="f['name']"></app-control-messages>
            </div>
            <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
              {{'requestPolicyProgram.policyProgramType' | translate}}
            </label>
            <div class="ui-g-12 ui-md-6 ui-lg-3">
                <select-filter
                [property]="f['policyProgramType']"
                [options]="policyProgramTypeList"
                optionLabel="name"
                optionValue="categoryId"
                [placeHolder]="'common.label.cboSelectAll'"
                >
              </select-filter>
              <app-control-messages [control]="f['policyProgramType']"></app-control-messages>
            </div>
          </div>
          <div class="ui-g-12 vt-row">
            <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
              {{'requestPolicyProgram.requestDateFromDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker
                  [property]="f['requestDateFromDate']">
                </date-picker>
                <app-control-messages [control]="f['requestDateFromDate']"></app-control-messages>
              </div>
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                {{'common.label.toDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker
                  [property]="f['requestDateToDate']">
                </date-picker>
              <app-control-messages [control]="f['requestDateToDate']"></app-control-messages>
            </div>
          </div>
          <div class="ui-g-12 vt-row">
            <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
              {{'app.requestResolutionMonth.finishDate' | translate}} {{'common.label.fromDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker
                  [property]="f['finishDateFromDate']">
                </date-picker>
                <app-control-messages [control]="f['finishDateFromDate']"></app-control-messages>
              </div>
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                {{'common.label.toDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker
                  [property]="f['finishDateToDate']">
                </date-picker>
              <app-control-messages [control]="f['finishDateToDate']"></app-control-messages>
            </div>
          </div>
        </div>
        <div class="panel-footer vt-area-button">
          <button type="submit" class="btn btn-sm btn-info" (click)="processSearch()" [innerHTML]="'common.button.icon.search' | translate" ></button>
          <button type="button" *ngIf="hasPermission('action.insert')" class="btn btn-sm btn-info" (click)="prepareSaveOrUpdate()" [innerHTML]="'common.button.icon.addNew' | translate" ></button>
          <button *ngIf="hasPermission('action.export')" type="button" class="btn btn-sm btn-info" 
              (click)="export()" [innerHTML]="'common.button.icon.exportFile' | translate"></button>
      </div>
      </form>
    </div>
  </div>
</div>
<div id="listArea">
    <div class="panel panel-default">
      <div class="panel-heading vt-relative">
        <strong class="text-u-c">
          <i class="fa fa-th"></i>
          {{'requestPolicyProgram.titleTable' | translate}}
        </strong>
      </div>
      <div class="panel-body panel-table">
        <p-table
          #ptable
          [value]="resultList.data"
          [paginator]="true"
          (onLazyLoad)="processSearch($event)"
          [lazy]="true" [rows]="changeRow"
          [totalRecords]="resultList.recordsTotal"
          [scrollable]="true"
          [lazyLoadOnInit]="false"
          tableStyleClass="table table-wrapper table-hover table-striped b-t b-b" 
          styleClass="controlOverflow"
        >
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <col class="size-1">
              <col class="size-5">
              <col class="size-8">
              <col class="size-10">
              <col class="size-12">
              <col class="size-6">
              <col class="size-6">
              <col class="size-5">
              <col class="size-5">
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <th translate>common.table.index</th>
              <th>{{'democraticmeeting.label.action' | translate}}</th>
              <th [pSortableColumn]="'code'">
                  {{'democraticmeeting.label.code' | translate}}
                <p-sortIcon [field]="'code'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'name'" >
                  {{'democraticmeeting.label.name' | translate}}
                <p-sortIcon [field]="'name'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'organizationName'">
                {{'democraticmeeting.label.organizationRequest' | translate}}
              <p-sortIcon [field]="'organizationName'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'policyProgramTypeName'">
                {{'requestPolicyProgram.policyProgramType' | translate}}
              <p-sortIcon [field]="'policyProgramTypeName'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'status'">
                {{'requestPolicyProgram.status' | translate}}
                <p-sortIcon [field]="'status'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'requestDate'">
                {{'label.requestPolicyProgram.requestedDate' | translate}}
                <p-sortIcon [field]="'requestDate'"></p-sortIcon>
                </th>
              <th [pSortableColumn]="'finishDate'">
                {{'label.requestPolicyProgram.finishDate' | translate}}
                <p-sortIcon [field]="'finishDate'"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item let-index="rowIndex+1">
            <tr>
              <td class="vt-align-center">{{index}}</td>
              <td class="vt-align-center">
                <div ngbDropdown class="d-inline-block">
                  <button class="btn btn-sm btn-info" ngbDropdownToggle translate>common.label.action</button>
                  <div ngbDropdownMenu>
                    <!-- sua -->
                    <div >
                      <button *ngIf="item.status==1 && hasPermission('action.update')" class="dropdown-item" (click)="prepareSaveOrUpdate(item)"
                        [innerHTML]="'common.button.table.acteditdropdown' | translate">
                      </button>
                    </div>
                    <!-- thu hoi chinh sach -->
                    <div>
                      <button *ngIf="hasPermission('action.delete')" class="dropdown-item" (click)="delete(item)"
                        [innerHTML]="'common.button.revokedropdown' | translate">
                      </button>
                    </div>
                    <!-- Gửi yêu cầu -->
                    <div >
                      <button *ngIf="item.status==1 && hasPermission('action.update')" class="dropdown-item" (click)="sendRequest(item)"
                        [innerHTML]="'common.button.table.actSendRequest' | translate">
                      </button>
                    </div>
                    <!-- Xem chi tiết -->
                    <div>
                      <button *ngIf="hasPermission('action.view')" class="dropdown-item" (click)="view(item)"
                        [innerHTML]="'common.button.table.viewdropdown' | translate">
                      </button>
                    </div>
                    <!-- Báo cáo thực hiện-->
                    <div >
                      <button *ngIf="item.status === 2 && hasPermission('action.export')" class="dropdown-item" (click)="prepareExport(item)"
                        [innerHTML]="'common.button.table.export' | translate">
                      </button>
                    </div>
                  </div>
                </div>
              </td>
              <td class="vt-align-center">{{item.code}}</td>
              <td class="vt-align-left">{{item.name}}</td>
              <td class="vt-align-left">{{item.organizationName}}</td>
              <td class="vt-align-left">{{item.policyProgramTypeName}}</td>
              <td class="vt-align-left">
                <div class="label-status notYet" *ngIf="item.status==1" translate></div>
                <div class="label-status info" *ngIf="item.status==2" translate></div>
                {{'requestSolutionMonth.status.' + item.status | translate}}
              </td>
              <td class="vt-align-center">{{item.requestDate | displayDate}}</td>
              <td class="vt-align-center">{{item.finishDate | displayDate}}</td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr class="emptymessage">
              <td [attr.colspan]="14" [innerHTML]="'app.noRecords' | translate">
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="paginatorleft">
            <table-footer (changeRow)="onTablePageChange($event)"  [resultList]="resultList"></table-footer>
          </ng-template>
        </p-table>
      </div>
    </div>
</div>

