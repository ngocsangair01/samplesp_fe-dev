<div *ngIf="hasPermission('action.view')">
  <div id="searchPage">
    <div id="searchArea">
      <div class="panel panel-default">
        <div class="panel-heading" translate>
          <strong class="text-u-c">
            <i class="fa fa-th"></i> common.label.search.info
          </strong>
        </div>
        <form id="formSearch" [formGroup]="formSearch">
          <div class="panel-body padding-xl ui-g">
            <div class="ui-g-12 vt-row">
              <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                {{'label.requestPolicyProgram.name' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <input type="text" class="form form-control" name="requestName" formControlName="requestName"
                  maxlength="200" [autoFocus]="true">
                <app-control-messages [control]="f['requestName']"></app-control-messages>
              </div>
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                {{'label.requestPolicyProgram.organizationRequest' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <input type="text" class="form form-control" name="organizationName" formControlName="organizationName"
                  maxlength="200">
                <app-control-messages [control]="f['organizationName']"></app-control-messages>
              </div>
            </div>
            <div class="ui-g-12 vt-row ">
              <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                {{'requestPolicyProgram.requestDateFromDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="f['requestFromDate']">
                </date-picker>
                <app-control-messages [control]="f['requestFromDate']"></app-control-messages>
              </div>
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">                
                {{'common.label.toDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="f['requestToDate']">
                </date-picker>
                <app-control-messages [control]="f['requestToDate']"></app-control-messages>
              </div>
            </div>
            <div class="ui-g-12 vt-row">
              <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                {{'common.label.finishDate.from' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="f['finishFromDate']">
                </date-picker>
                <app-control-messages [control]="f['finishFromDate']"></app-control-messages>
              </div>
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                {{'common.label.toDate' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="f['finishToDate']">
                </date-picker>
                <app-control-messages [control]="f['finishToDate']"></app-control-messages>
              </div>
            </div>
            <div class="ui-g-12 vt-row">
              <!-- Ngày ký quyết định từ -->
              <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                {{'organizationcontroller.table.from.datePromulgate'|translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="formSearch.controls.startDate"></date-picker>
                <app-control-messages [control]="f['startDate']"></app-control-messages>
              </div>
              <!-- Ngày ký quyết định đến -->
              <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right">
                {{'organizationcontroller.table.to.date'|translate}} 
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <date-picker [property]="formSearch.controls.endDate"></date-picker>
                <app-control-messages [control]="f['endDate']"></app-control-messages>
              </div>
            </div>
            <div class="ui-g-12 vt-row">
              <!-- Số quyết định -->
              <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                {{'label.commendations.number' | translate}}
              </label>
              <div class="ui-g-12 ui-md-6 ui-lg-3">
                <input type="text" formControlName="documentCode" class="form-control">
              </div>
            </div>
          </div>
          <div class="panel-footer vt-area-button">
            <button type="submit" class="btn btn-sm btn-info" (click)="processSearch()"
              [innerHTML]="'common.button.icon.search' | translate"></button>
            <button *ngIf="hasPermission('action.export')" type="button" class="btn btn-sm btn-info" 
              (click)="export()" [innerHTML]="'common.button.icon.exportFile' | translate"></button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div id="listArea">
    <div class="panel panel-default">
      <div class="panel-heading vt-relative">
        <strong class="text-u-c">
          <i class="fa fa-th"></i>
          {{'label.responsePolicyProgram.tableTitle' | translate}}
        </strong>
      </div>
      <div class="panel-body panel-table">
        <p-table 
          #ptable 
          [value]="resultList.data" 
          [paginator]="true" 
          (onLazyLoad)="processSearch($event)" 
          [lazy]="true"
          [rows]="changeRow"
          [totalRecords]="resultList.recordsTotal" 
          [scrollable]="true" 
          [lazyLoadOnInit]="false"
          tableStyleClass="table table-wrapper table-hover table-striped b-t b-b"
          styleClass="controlOverflow"
          >
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <col class="size-1">
              <col class="size-6" *ngIf="hasPermission('action.update')">
              <col class="size-12">
              <col class="size-12">
              <col class="size-12">
              <col class="size-4">
              <col class="size-4">
              <col class="size-6">
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <th translate>common.table.index</th>
              <th *ngIf="hasPermission('action.update')" translate>common.label.action</th>
              <th [pSortableColumn]="'requestName'">
                {{'label.requestPolicyProgram.name' | translate}}
                <p-sortIcon [field]="'requestName'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'organizationNameRequest'">
                {{'label.responsePolicyProgram.orgzationNameRequest' | translate}}
                <p-sortIcon [field]="'organizationNameRequest'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'organizationName'">
                {{'label.responsePolicyProgram.orgzationName' | translate}}
                <p-sortIcon [field]="'organizationName'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'requestDate'">
                {{'label.requestPolicyProgram.requestedDate' | translate}}
                <p-sortIcon [field]="'requestDate'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'finishDate'">
                {{'label.requestPolicyProgram.finishDate' | translate}}
                <p-sortIcon [field]="'finishDate'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'status'">
                {{'label.responsePolicyProgram.status' | translate}}
                <p-sortIcon [field]="'status'"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item let-index="rowIndex+1">
            <tr>
              <td class="vt-align-center">{{index}}</td>
              <td class="vt-align-center" *ngIf="hasPermission('action.update')">
                <div ngbDropdown class="d-inline-block">
                  <button class="btn btn-sm btn-info" ngbDropdownToggle translate>common.label.action</button>
                  <div ngbDropdownMenu>
                    <!-- Trinh ky -->
                    <div *ngIf="item.status !== 0 && item.status !== 2 && item.status !== 4 && hasPermission('action.update') && item.signDocumentId > 0">
                      <button class="dropdown-item" (click)="prepareSign(item)"
                        [innerHTML]="'common.button.table.actSign' | translate">
                      </button>
                    </div>
                    <!-- Hủy trình ký -->
                    <div *ngIf="item.status == 2 && hasPermission('action.update') && item.signDocumentId > 0">
                      <button class="dropdown-item" (click)="cancelSignPolicyProgram(item)"
                        [innerHTML]="'common.button.icon.cancelSignReward' | translate">
                      </button>
                    </div>
                    <div *ngIf="item.status !== 2 && item.status !== 4 && hasPermission('action.update')">
                      <button class="dropdown-item" (click)="import(item)"
                        [innerHTML]="'common.button.table.task' | translate">
                      </button> 
                    </div>
                    <!-- Xem file trình ký -->
                    <div *ngIf="item.attachSignDocumentId && hasPermission('action.view')">
                      <button class="dropdown-item" (click)="previewFileSigning(item.signDocumentId)"
                        [innerHTML]="'common.button.table.previewFileSigning' | translate">
                      </button>
                    </div>
                  </div>
                </div>
              </td>
              <td class="vt-align-left">{{item.requestName}}</td>
              <td class="vt-align-left">{{item.organizationNameRequest}}</td>
              <td class="vt-align-left">{{item.organizationName}}</td>
              <td class="vt-align-center">{{item.requestDate | displayDate}}</td>
              <td class="vt-align-center">{{item.finishDate | displayDate}}</td>
              <td class="vt-align-left">
                <span [ngClass]="item.signDocumentId && item.status != 0? 'cs-point' : ''" (click)="actionShowHistory(item)">
                  <div class="label-status notYet" *ngIf="item.status==0" translate>app.democraticMeeting.status.noprocess</div>
                  <div class="label-status warning" *ngIf="item.status==1" translate>app.democraticMeeting.status.processing</div>
                  <div class="label-status info" *ngIf="item.status==2" translate>app.democraticMeeting.status.signing</div>
                  <div class="label-status danger" *ngIf="item.status==3" translate>app.democraticMeeting.status.decline</div>
                  <div class="label-status info" *ngIf="item.status==4" translate>app.democraticMeeting.status.approved</div>
                </span>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr class="emptymessage">
              <td [attr.colspan]="13" [innerHTML]="'app.noRecords' | translate">
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="paginatorleft">
            <table-footer (changeRow)="onTablePageChange($event)" [resultList]="resultList"></table-footer>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
</div>