<div class="card-reward">
  <div class="clearfix">
    <div class="left-nav-bar pull-left row-header">
      <div>
        <img alt="back" class="img-fluid" src="./../../../../../../assets/images/home/Mask_Group_18824.png" (click)="goBack();">
        <span *ngIf="create" class="title" > Thêm mới đề xuất trợ cấp</span>
        <span *ngIf="update" class="title" > Cập nhật đề xuất trợ cấp</span>
        <span *ngIf="view" class="title" > Xem chi tiết đề xuất trợ cấp</span>
      </div>
    </div>
    <div class="right-nav-bar pull-right left-option">
      <ul class="header-right sys-ul space-line">
        <li>
          <button class="btn btn-sm vt-btn ng-star-inserted" type="button" (click)="goBack();" [innerHTML]="'common.button.out' | translate">
          </button>
        </li>
        <li *ngIf="!view">
          <button class="btn btn-sm vt-btn btn-submit ng-star-inserted" type="button" (click)="processSaveOrUpdate(3)" [innerHTML]="'common.button.icon.save' | translate">
          </button>
        </li>
        <li *ngIf="view && f['status'].value == 0">
          <button class="btn btn-sm vt-btn btn-submit ng-star-inserted" type="button" (click)="navigate()" [innerHTML]="'common.button.icon.edit' | translate">
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>
<div class="info">
  <form id="formSave" [formGroup]="formSave">
    <div class="panel panel-default card-info">
      <div class="panel-heading">
        <strong>
          <span class="ml-2 title-info">Thông tin đề xuất trợ cấp</span>
        </strong>
      </div>
      <div class="panel-body padding-xl ui-g">
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right required">
            {{'subsidizedSuggest.label.subsidizedPeriodId' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <select-filter [property]="f['allowancePeriodId']" [options]="AllowancePeriodList" (onChange)="changeAllowancePeriod()" optionLabel="name" optionValue="allowancePeriodId"
                           [placeHolder]="'common.label.cboMustSelect'" [disabled]="view">
            </select-filter>
            <app-control-messages [control]="f['allowancePeriodId']"></app-control-messages>
          </div>
          <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right required">
            {{'label.welfare.policy.category.organizationModel' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <select-filter [property]="f['orgType']" [options]="orgTypeOptions" optionLabel="name" optionValue="id"
                           [placeHolder]="'common.label.cboMustSelect'"  [disabled]="true">
            </select-filter>
            <app-control-messages [control]="f['orgType']"></app-control-messages>
          </div>
        </div>
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right required">
            {{'label.allowance.proposal.search.name' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <input type="text" class="form form-control" name="name" formControlName="name"
                   maxlength="200" [attr.disabled]="view? true: null">
            <app-control-messages [control]="f['name']"></app-control-messages>
          </div>
          <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right required">
            {{'label.allowance.period.search.allowanceType' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <select-filter [property]="f['allowanceType']" [options]="allowanceTypeOptions" optionLabel="name" optionValue="value"
                           [placeHolder]="'common.label.cboMustSelect'"  [disabled]="true">
            </select-filter>
            <app-control-messages [control]="f['allowanceType']"></app-control-messages>
          </div>
        </div>
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right required">
            {{'label.allowance.proposal.search.proposeOrgId' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <mass-org-selector
                    [property]="f['proposeOrgId']"
                    operationKey="action.view"
                    adResourceKey="resource.allowanceProposal"
                    [defaultValue]="true"
                    [autoFocus]="true"
                    [branch] = "branch"
                    [disabled]="view"
                    (onChange)="changeProposeOrgId()">
            </mass-org-selector>
            <app-control-messages [control]="f['proposeOrgId']"></app-control-messages>
          </div>
          <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right required">
            {{'label.allowance.proposal.search.approveOrgId' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <mass-org-selector
                    [property]="f['approveOrgId']"
                    operationKey="action.view"
                    adResourceKey="resource.allowancePeriod"
                    [defaultValue]="true"
                    [branch] = "branch"
                    [rootId]="rootId"
                    [disabled]=" view">
            </mass-org-selector>
            <app-control-messages [control]="f['approveOrgId']"></app-control-messages>
          </div>
        </div>
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-md-5 ui-lg-2 control-label vt-align-right required">
            {{'label.welfare.policy.proposal.spendingOrg1' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <select-filter [property]="f['signOrgId']"
                           [options]="orgOptions"
                           optionLabel="name"
                           optionValue="organizationId"
                           [placeHolder]="'common.label.cboMustSelect'"
                           [disabled]="view"
                           (onChange)="changeProposeOrgId()">
            </select-filter>
<!--            <org-selector [property]="f['signOrgId']"-->
<!--                          operationKey="action.view"-->
<!--                          adResourceKey="resource.employeeManager"-->
<!--                          [defaultValue]="true"-->
<!--                          [disabled]="view">-->
<!--            </org-selector>-->
            <app-control-messages [control]="f['signOrgId']"></app-control-messages>
          </div>
          <label class="ui-g-12 ui-md-3 control-label vt-align-right">
            {{'common.label.attachmentFile' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3">
            <multi-file-chooser class="attachment-file" [property]="f['attachedFiles']" fileName="attachedFiles" [validMaxSize]="50"
                                validType="png,jpg,gif,tiff,bmp,xls,xlsx,doc,docx,pdf,rar,zip,7z"
                                [disabled]="view  ? true : null">
            </multi-file-chooser>
            <app-control-messages [control]="f['attachedFiles']"></app-control-messages>
          </div>
        </div>
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
            {{'rewardPropose.isSynthetic' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3 position-relative">
            <input type="checkbox" name="isSynthetic" formControlName="isSynthetic" [attr.disabled]="view ? true : null"
              style="width: 18px;
                height: 1.5rem;" [value]="0" (change)="onChangeSynthetic($event)">
          </div>

          <label class="ui-g-12 ui-md-3 control-label vt-align-right required" *ngIf="formSave.get('isSynthetic').value !== 1" [ngClass]="{'isHidden' : formSave.controls['isSynthetic'].value}">
            {{'label.welfare.policy.proposal.proposalEmployee' | translate}}
          </label>
          <div class="ui-g-12 ui-md-6 ui-lg-3" *ngIf="formSave.get('isSynthetic').value !== 1" [ngClass]="{'isHidden' : formSave.controls['isSynthetic'].value}">
            <data-picker [property]="f['receiverId']" systemCode="political" operationKey="action.view"
              adResourceKey="resource.welfarePolicyProposal" objectBO="EmployeeBO" codeField="employeeCode"
              nameField="fullName" emailField="email" mobileNumberField="mobileNumber" selectField="employeeId"
              isPartyMember="'true'" type="employee" [filterCondition]="employeeFilterCondition" [disabled]="this.view"
              (onChange)="fillEmployeeToList()"
              >             
            </data-picker>
          </div>
        </div>



        <div [ngClass]="{'isHidden' : !formSave.controls['isSynthetic'].value}">
          <div class="scollTable panel panel-default">
            <div class="panel-heading vt-relative">
              <strong>
                <span class="title">{{ 'rewardPropose.label.rewardDecide' | translate }}</span>
              </strong>
            </div>
            <div class="p-3">
              <div id="formSaveRewardDecide">
                <div class="panel-body panel-table" style="padding: 12px;">
                  <p-table [scrollable]="true" [value]="allowanceProposalBOList.controls" [paginator]="true" [resizableColumns]="true"
                           [first]="firstRowIndex" [rows]="pageSize" [totalRecords]="allowanceProposalBOList ? allowanceProposalBOList.length : 0"
                           tableStyleClass="table table-wrapper table-hover table-striped b-t b-b">
                    <div class="tbl-panel">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col style="width: 50px;">
                          <col *ngIf="!view" style="width: 100px;">
                          <col style="width: 100px;display: none">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header">
                        <tr>
                          <th pResizableColumn translate>common.table.index</th>
                          <th pResizableColumn *ngIf="!view" translate><span>common.label.action</span></th>
                          <th pResizableColumn translate style="display: none"></th>
                          <th pResizableColumn translate>decide.rewardPropose.label.name</th>
                          <th pResizableColumn translate>subsidizedSuggest.label.subsidizedPeriodId</th>
                          <th pResizableColumn translate>label.allowance.proposal.search.proposeOrgId</th>
                          <th pResizableColumn translate>label.allowance.proposal.search.approveOrgId</th>
                          <th pResizableColumn translate>label.welfare.policy.category.organizationModel</th>
                          <th pResizableColumn translate>decide.rewardPropose.label.year</th>
                          <th pResizableColumn translate>label.welfare.policy.proposal.signer</th>
                          <th pResizableColumn translate>label.welfare.policy.proposal.total</th>
                          <th pResizableColumn translate>common.label.status</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-item let-index="rowIndex">
                        <tr >
                          <td class="vt-align-center">
                            {{index+1}}
                          </td>
                          <td class="vt-align-center" *ngIf="!view && item.value.allowanceProposalId">
                            <button class="btn-icon minus" type="button" (click)="removeRow(index, item)"
                                    [innerHTML]="'common.icon.minus' | translate">
                            </button>
                          </td>
                          <td class="vt-align-left" style="display:none;">
                            {{item.value.allowanceProposalId}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.name}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.allowancePeriod}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.proposeOrg}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.approveOrg}}
                          </td>
                          <td class="vt-align-left">
                            <div *ngIf="item.value.orgType === 1" >Tổ chức Đảng</div>
                            <div *ngIf="item.value.orgType === 2" >Tổ chức Công đoàn</div>
                            <div *ngIf="item.value.orgType === 3" >Tổ chức Phụ nữ</div>
                            <div *ngIf="item.value.orgType === 4" >Tổ chức Thanh niên</div>
                            <div *ngIf="item.value.orgType === 5" >Chính quyền</div>
                          </td>
                          <td class="vt-align-left">
                            {{item.value.year}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.employeeProposal}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.amountTotal}}
                          </td>
                          <td class="vt-align-left">
                            <div *ngIf="item.value.status === 0" >Dự thảo</div>
                            <div *ngIf="item.value.status === 1" >Chờ xét chọn</div>
                            <div *ngIf="item.value.status === 2" >Đang xét chọn</div>
                            <div *ngIf="item.value.status === 3" >Bị từ chối</div>
                            <div *ngIf="item.value.status === 4" >Đang trình ký</div>
                            <div *ngIf="item.value.status === 5" >Đã xét chọn</div>
                          </td>
                        </tr>
                      </ng-template>
                    </div>
                  </p-table>
                </div>
              </div>
              <button type="button" class="btn btn-sm vt-btn " [innerHTML]="'titleSelectAdd' | translate" *ngIf="!view" (click)="showPopupAdd()"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="width: 100%;">
      <p-tabView class="tab-view">
        <p-tabPanel header="Danh sách chi tiết - Bản thân">
          <div class="scollTable panel panel-default" >
<!--            <div class="panel-heading vt-relative">-->
<!--              <strong>-->
<!--                <span class="title">{{ 'rewardPropose.label.rewardDecide' | translate }}</span>-->
<!--              </strong>-->
<!--            </div>-->
            <div class="p-3">
              <div id="formSaveRewardDecide">
                <div class="panel-body panel-table" style="padding: 12px;">
                  <p-table [scrollable]="true" [value]="empAllowanceRequestBTBOList.controls" [paginator]="true" [resizableColumns]="true"
                           [first]="firstRowIndexBT" [rows]="pageSizeBT" [totalRecords]="empAllowanceRequestBTBOList ? empAllowanceRequestBTBOList.length : 0"
                           tableStyleClass="table table-wrapper table-hover table-striped b-t b-b">
                    <div class="tbl-panel">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col style="width: 50px;">
                          <col style="width: 50px;">
                          <col style="width: 100px; display: none">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header">
                        <tr>
                          <th pResizableColumn translate>common.table.index</th>
                          <th pResizableColumn translate><span>common.label.action</span></th>
                          <th pResizableColumn translate style="display: none"></th>
                          <th pResizableColumn translate>common.label.partymembersCode</th>
                          <th pResizableColumn translate>PartyMemberBO.memberName</th>
                          <th pResizableColumn translate>rewardGeneral.workunit</th>
                          <th pResizableColumn translate>subsidizedSuggest.label.subsidizedPeriodId</th>
                          <th pResizableColumn translate>label.welfare.policy.request.requestContent</th>
                          <th pResizableColumn translate>label.welfare.policy.desease.category</th>
                          <th pResizableColumn translate>label.allowance.request.search.reason</th>
                          <th pResizableColumn translate>label.welfare.policy.proposal.total</th>
                          <th pResizableColumn>
                            {{'label.welfare.policy.proposal.proposalEmployee' | translate}}
                          </th>
              
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-item let-index="rowIndex">
                        <tr [formGroup]="item">
                          <td class="vt-align-center">
                            {{index+1}}
                          </td>
                          <td class="vt-align-center">
                            <div ngbDropdown class="d-inline-block" *ngIf="item.value.empAllowanceRequestId">
                              <div ngbDropdownToggle class="vt-action-hover">
                                <img class="menu-icon" src="./../../../assets/images/home/Icon.svg">
                              </div>
                              <div ngbDropdownMenu class="vt-border-radius">
                                <!-- View detail -->
                                <div>
                                  <button class="dropdown-item" (click)="viewDetailEmpAllowanceRequest(item)"
                                          [innerHTML]="'common.button.table.viewdropdown' | translate">
                                  </button>
                                </div>
                                <!-- bổ sung giấy tờ -->
                                <div>
                                  <button class="dropdown-item" (click)="processUpdate(item, 3)"
                                          [innerHTML]="'common.button.table.addDocument' | translate">
                                  </button>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="vt-align-left" style="display: none">
                            {{item.value.empAllowanceRequestId}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.employeeCode}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.employeeName}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.orgName}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.allowancePeriod}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.content}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.desease}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.reason}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.amountTotal}}
                          </td>
                          <td class="vt-align-left ">
                            <data-picker [property]="item.controls.receiverId" systemCode="political" operationKey="action.view"
                              adResourceKey="resource.welfarePolicyProposal" objectBO="EmployeeBO" codeField="employeeCode"
                              nameField="fullName" emailField="email" mobileNumberField="mobileNumber" selectField="employeeId"
                              isPartyMember="'true'" [filterCondition]="employeeFilterCondition" type="employee"
                             >
                            </data-picker>
                          </td>
                        </tr>
                      </ng-template>
                    </div>
                  </p-table>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>
        <p-tabPanel header="Danh sách chi tiết - thân nhân">
          <div class="scollTable panel panel-default" >
<!--            <div class="panel-heading vt-relative">-->
<!--              <strong>-->
<!--                <span class="title">{{ 'rewardPropose.label.rewardDecide' | translate }}</span>-->
<!--              </strong>-->
<!--            </div>-->
            <div class="p-3">
              <div id="formSaveRewardDecide">
                <div class="panel-body panel-table" style="padding: 12px;">
                  <p-table [scrollable]="true" [value]="empAllowanceRequestNTBOList.controls" [paginator]="true" [resizableColumns]="true"
                           [first]="firstRowIndexNT" [rows]="pageSizeNT" [totalRecords]="empAllowanceRequestNTBOList ? empAllowanceRequestNTBOList.length : 0"
                           tableStyleClass="table table-wrapper table-hover table-striped b-t b-b">
                    <div class="tbl-panel">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col style="width: 50px;">
                          <col style="width: 50px;">
                          <col style="width: 100px; display: none">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                          <col style="width: 100px;">
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header">
                        <tr>
                          <th pResizableColumn translate>common.table.index</th>
                          <th pResizableColumn translate><span>common.label.action</span></th>
                          <th pResizableColumn translate style="display: none"></th>
                          <th pResizableColumn translate>common.label.partymembersCode</th>
                          <th pResizableColumn translate>PartyMemberBO.memberName</th>
                          <th pResizableColumn translate>rewardGeneral.workunit</th>
                          <th pResizableColumn translate>subsidizedSuggest.label.subsidizedPeriodId</th>
                          <th pResizableColumn translate>label.welfare.policy.category.relationship</th>
                          <th pResizableColumn translate>label.welfare.policy.requestList.objectName</th>
                          <th pResizableColumn translate>label.welfare.policy.request.requestContent</th>
                          <th pResizableColumn translate>label.welfare.policy.desease.category</th>
                          <th pResizableColumn translate>label.allowance.request.search.reason</th>
                          <th pResizableColumn translate>label.welfare.policy.proposal.total</th>
                          <th pResizableColumn>
                            {{'label.welfare.policy.proposal.proposalEmployee' | translate}}
                          </th>
              
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-item let-index="rowIndex">
                        <tr [formGroup]="item">
                          <td class="vt-align-center">
                            {{index+1}}
                          </td>
                          <td class="vt-align-center">
                            <div ngbDropdown class="d-inline-block" *ngIf="item.value.empAllowanceRequestId">
                              <div ngbDropdownToggle class="vt-action-hover">
                                <img class="menu-icon" src="./../../../assets/images/home/Icon.svg">
                              </div>
                              <div ngbDropdownMenu class="vt-border-radius">
                                <!-- View detail -->
                                <div>
                                  <button class="dropdown-item" (click)="viewDetailEmpAllowanceRequest(item)"
                                          [innerHTML]="'common.button.table.viewdropdown' | translate">
                                  </button>
                                </div>
                                <!-- bổ sung giấy tờ -->
                                <div>
                                  <button class="dropdown-item" (click)="processUpdate(item, 3)"
                                          [innerHTML]="'common.button.table.addDocument' | translate">
                                  </button>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="vt-align-left" style="display: none">
                            {{item.value.empAllowanceRequestId}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.employeeCode}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.employeeName}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.orgName}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.allowancePeriod}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.relationShip}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.objectName}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.content}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.desease}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.reason}}
                          </td>
                          <td class="vt-align-left">
                            {{item.value.amountTotal}}
                          </td>
                          <td class="vt-align-left ">
                            <data-picker [property]="item.controls.receiverId" systemCode="political" operationKey="action.view"
                              adResourceKey="resource.welfarePolicyProposal" objectBO="EmployeeBO" codeField="employeeCode"
                              nameField="fullName" emailField="email" mobileNumberField="mobileNumber" selectField="employeeId"
                              isPartyMember="'true'" [filterCondition]="employeeFilterCondition" type="employee"
                             >
                            </data-picker>
                          </td>
                        </tr>
                      </ng-template>
                    </div>
                  </p-table>
                </div>
              </div>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>
  </form>
</div>
