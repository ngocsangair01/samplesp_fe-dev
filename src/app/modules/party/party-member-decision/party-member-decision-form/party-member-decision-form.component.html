<div class="card-form">
  <div class="clearfix">
    <div class="left-nav-bar pull-left row-header">
      <div>
        <img alt="back" class="img-fluid" src="./../../../../../../assets/images/home/Mask_Group_18824.png" (click)="goBack();">
        <span *ngIf="isView" class="title">{{'common.button.table.hEye' | translate}}</span>
        <span *ngIf="isInsert" class="title">{{'common.label.add' | translate}}</span>
        <span *ngIf="isUpdate" class="title">{{'common.label.update' | translate}}</span>
<!--          <div class="row">-->
<!--              <span class="right-title"> {{'partyMemberDecision.decision' | translate}}</span>-->
<!--              <span class="right-title"> {{'partyMemberDecision.decisionType.' + DECISION_TYPE[decisionType].value | translate}}</span>-->
<!--          </div>-->
      </div>
    </div>


    <div class="right-nav-bar pull-right left-option">
        <ul class="header-right sys-ul space-line">
          <li>
            <button class="btn btn-sm vt-btn mt-btn ng-star-inserted" type="button" (click)="goBack();" [innerHTML]="'common.button.out' | translate">
            </button>
          </li>
          <li *ngIf="!isView">
            <button class="btn btn-sm vt-btn btn-submit mt-btn ng-star-inserted" type="button" (click)="processSaveOrUpdate()" [innerHTML]="'common.button.icon.save' | translate">
            </button>
          </li>
          <li *ngIf="isView">
            <button class="btn btn-sm vt-btn btn-submit mt-btn ng-star-inserted" type="button" (click)="exportDecision()" [innerHTML]="'partyMemberDecision.exportFile' | translate">
            </button>
          </li>
        </ul>
    </div>
  </div>
</div>
<div class="info">
  <div
    *ngIf="(hasPermission('action.view') && isView) || (hasPermission('action.update') && isUpdate) || (hasPermission('action.insert') && isInsert)">
  <div class="panel panel-default card-info">
    <div class="panel-heading vt-relative" style="flex-direction: column; justify-content: center; align-items: flex-start">
      <strong>
        <span class="ml-2 title-info">Thông tin quyết định </span>
      </strong>
        <strong>
            <span class="ml-4 title-info">{{'partyMemberDecision.decisionType.' + DECISION_TYPE[decisionType].value | translate}}</span>
        </strong>
    </div>
    <form id="formSave" [formGroup]="formSave">
      <div class="panel-body padding-xl ui-g">
        <!-- row 1 -->
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
            {{'partyMemberDecision.symbol' | translate}}
          </label>
          <div class="ui-g-12 ui-lg-3">
            <input [attr.disabled]="true" type="text" class="form form-control" name="symbol" formControlName="symbol"
              maxlength="50">
            <app-control-messages [control]="f['symbol']"></app-control-messages>
          </div>
          <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
            {{'partyMemberDecision.extractingTextContent' | translate}}
          </label>
          <div class="ui-g-12 ui-lg-3">
            <input type="text" [autoFocus]="true" [attr.disabled]="isView ? true : null" class="form form-control"
              name="extractingTextContent" formControlName="extractingTextContent" maxlength="250">
            <app-control-messages [control]="f['extractingTextContent']"></app-control-messages>
          </div>
        </div>
        <!-- row 2  -->
        <div class="ui-g-12 vt-row">
          <ng-container *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.resolutionNumberPartyBranch' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <input type="text" [attr.disabled]="isView ? true : null" class="form form-control" name="resolutionNumberPartyBranch"
                formControlName="resolutionNumberPartyBranch" maxlength="250">
              <app-control-messages [control]="f['resolutionNumberPartyBranch']"></app-control-messages>
            </div>
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.resolutionNumberPartyCommittee' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <input type="text" [attr.disabled]="isView ? true : null" class="form form-control" name="resolutionNumberPartyCommittee"
                formControlName="resolutionNumberPartyCommittee" maxlength="250">
              <app-control-messages [control]="f['resolutionNumberPartyCommittee']"></app-control-messages>
            </div>
          </ng-container>
          <ng-container *ngIf="decisionType === DECISION_TYPE.XTDV.code || decisionType === DECISION_TYPE.CRKD.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'common.label.effectiveDate' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <date-picker [property]="f['effectiveDate']" [disabled]="isView"></date-picker>
              <app-control-messages [control]="f['effectiveDate']"></app-control-messages>
            </div>
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.partyOrganizationDecision' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <party-org-selector
                [property]="f['partyOrganizationDecisionId']"
                [checkPermission]="false"
                [disabled]="isView"
                operationKey="action.view"
                adResourceKey="resource.partyMemberDecision">
              </party-org-selector>
              <app-control-messages [control]="f['partyOrganizationDecisionId']"></app-control-messages>
            </div>
          </ng-container>
          <ng-container *ngIf="decisionType === DECISION_TYPE.MSHD.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.partyOrganizationDecision' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <party-org-selector
                [property]="f['partyOrganizationDecisionId']"
                [defaultValue]="true"
                [checkPermission]="false"
                [disabled]="isView"
                operationKey="action.view"
                adResourceKey="resource.partyMemberDecision">
              </party-org-selector>
              <app-control-messages [control]="f['partyOrganizationDecisionId']"></app-control-messages>
            </div>
          </ng-container>
        </div>
        <!-- row 3 -->
        <div class="ui-g-12 vt-row">
          <ng-container *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'common.label.effectiveDate' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <date-picker [property]="f['effectiveDate']" [disabled]="isView"></date-picker>
              <app-control-messages [control]="f['effectiveDate']"></app-control-messages>
            </div>
          </ng-container>
          <ng-container *ngIf="decisionType === DECISION_TYPE.MSHD.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'common.label.effectiveDate' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <date-picker [property]="f['effectiveDate']" [disabled]="isView"></date-picker>
              <app-control-messages [control]="f['effectiveDate']"></app-control-messages>
            </div>
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'common.label.expiredDate' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <date-picker [property]="f['expiredDate']" [disabled]="isView"></date-picker>
              <app-control-messages [control]="f['expiredDate']"></app-control-messages>
            </div>
          </ng-container>
        </div>
        <!-- row 4 -->
        <div class="ui-g-12 vt-row">
          <ng-container *ngIf="decisionType === DECISION_TYPE.KNDV.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.partyOrganizationDecision' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <party-org-selector
                [property]="f['partyOrganizationDecisionId']"
                [isRequiredField]="true"
                [checkPermission]="false"
                [disabled]="isView"
                (onChange)="f['partyBranchAdmissionId'].setValue(null)"
                operationKey="action.view"
                adResourceKey="resource.partyMemberDecision">
              </party-org-selector>
              <app-control-messages [control]="f['partyOrganizationDecisionId']"></app-control-messages>
            </div>
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.partyBranchAdmission' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <party-org-selector
                [rootId]="f['partyOrganizationDecisionId'].value"
                [property]="f['partyBranchAdmissionId']"
                [isRequiredField]="true"
                [filterCondition]="partyOrgEffectiveCondition"
                [disabled]="isView || !f['partyOrganizationDecisionId'].value"
                (onChange)="onchangeOrgBranchAdmission($event)"
                operationKey="action.view"
                adResourceKey="resource.partyMemberDecision"
                #partyBranchAdmission>
              </party-org-selector>
              <app-control-messages [control]="f['partyBranchAdmissionId']"></app-control-messages>
            </div>
          </ng-container>
          <ng-container *ngIf="decisionType === DECISION_TYPE.CNDV.code">
            <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
              {{'partyMemberDecision.partyOrganizationDecision' | translate}}
            </label>
            <div class="ui-g-12 ui-lg-3">
              <party-org-selector
                [property]="f['partyOrganizationDecisionId']"
                [isRequiredField]="true"
                [checkPermission]="false"
                [disabled]="isView"
                operationKey="action.view"
                adResourceKey="resource.partyMemberDecision">
              </party-org-selector>
              <app-control-messages [control]="f['partyOrganizationDecisionId']"></app-control-messages>
            </div>
          </ng-container>
        </div>
        <div class="ui-g-12 vt-row">
          <label class="ui-g-12 ui-lg-2 control-label vt-align-right" [ngClass]="isView ? '' : 'required'">
            {{'partyMemberDecision.decisionMemberList' | translate}}
          </label>
          <div class="ui-g-12 ui-lg-9">
            <!-- <div class="panel-body panel-table"> -->
            <p-table [scrollable]="true" [value]="formDecisionMember.controls" styleClass="controlOverflow"
              tableStyleClass="table controls-table table-wrapper b-t b-b" [resizableColumns]="true">
              <ng-template pTemplate="colgroup" let-columns>
                <colgroup>
                  <col style="width: 50px;">
                  <col style="width: 100px;">
                  <col style="width: 100px;">
                  <col style="width: 100px;"
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                  <col style="width: 200px;"
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                  <col style="width: 100px;">
                  <col style="width: 100px;">
                  <col style="width: 200px;">
                  <col style="width: 200px;"
                    *ngIf="decisionType === DECISION_TYPE.XTDV.code || decisionType === DECISION_TYPE.CRKD.code || decisionType === DECISION_TYPE.MSHD.code">
                  <col *ngIf="!isView" style="width: 100px;">
                </colgroup>
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th  translate pResizableColumn>common.table.index</th>
                  <th pResizableColumn><span [ngClass]="isView ? '' : 'required'" translate>PartyMemberBO.memberCode</span></th>
                  <th translate pResizableColumn>PartyMemberBO.memberName</th>
                  <th translate pResizableColumn
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                    label.employee.dateOfBirth</th>
                  <th translate pResizableColumn
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                    partymanager.label.nativeLand</th>
                  <th translate pResizableColumn>partymanager.label.partyAdmisionDate</th>
                  <th translate pResizableColumn>partymanager.label.officialDateParty</th>
                  <th translate pResizableColumn>party.member.party.organization.label</th>
                  <th pResizableColumn *ngIf="decisionType === DECISION_TYPE.XTDV.code || decisionType === DECISION_TYPE.CRKD.code || decisionType === DECISION_TYPE.MSHD.code">
                    <span [ngClass]="isView ? '' : 'required'" translate>partyMemberDecision.reason</span>
                  </th>
                  <th *ngIf="!isView" translate pResizableColumn>common.label.action</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item let-index="rowIndex">
                <tr [formGroup]="item">
                  <td class="vt-align-center">
                    {{index+1}}
                  </td>
                  <td class="vt-align-center">
                    <data-picker
                      [property]="item.controls.employeeId"
                      [filterCondition]="partyMemberCondition"
                      [isRequiredField]="true"
                      [isDisplayCode]="true"
                      [disabled]="isView"
                      (onChange)="onChangeEmployee($event, index)"
                      operationKey="action.view"
                      adResourceKey="resource.partyMemberDecision"
                      objectBO="EmployeeBO"
                      codeField="employeeCode"
                      nameField="fullName"
                      emailField="email"
                      selectField="employeeId"
                      isSearchByPartyDomainData="true"></data-picker>
                    <app-control-messages [control]="item.controls.employeeId"></app-control-messages>
                  </td>
                  <td class="vt-align-left">
                    {{item.controls.fullName.value}}
                  </td>
                  <td class="vt-align-center"
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                    {{item.controls.dateOfBirth.value | displayDate}}
                  </td>
                  <td class="vt-align-left"
                    *ngIf="decisionType === DECISION_TYPE.KNDV.code || decisionType === DECISION_TYPE.CNDV.code">
                    {{item.controls.origin.value}}
                  </td>
                  <td class="vt-align-center">
                    {{item.controls.partyAdmissionDate.value | displayDate}}
                  </td>
                  <td class="vt-align-center">
                    {{item.controls.partyOfficialAdmissionDate.value | displayDate}}
                  </td>
                  <td class="vt-align-left">
                    {{item.controls.partyOrganizationName.value}}
                  </td>
                  <td class="vt-align-center"
                    *ngIf="decisionType === DECISION_TYPE.XTDV.code || decisionType === DECISION_TYPE.CRKD.code || decisionType === DECISION_TYPE.MSHD.code">
                    <textarea class="form-control" name="reason" formControlName="reason" maxlength="500" [attr.disabled]="isView ? true : null"></textarea>
                    <app-control-messages [control]="item.controls.reason"></app-control-messages>
                  </td>
                  <td class="vt-align-center" *ngIf="!isView">
                    <button type="button" class="btn-icon plus" [title]="'titleAdd' | translate"
                      (click)="addRow(index, item)" [innerHTML]="'common.icon.plus' | translate">
                    </button>
                    <button type="button" class="btn-icon minus" [title]="'titleDelete' | translate"
                      (click)="removeRow(index, item)" [innerHTML]="'common.icon.minus' | translate">
                    </button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
          <!-- </div> -->
        </div>
      </div>
    </form>
  </div>
  <div
    *ngIf="(!hasPermission('action.view') && isView) || (!hasPermission('action.update') && isUpdate) || (!hasPermission('action.insert') && isInsert)">
    {{'common.haveNoPermission' | translate}}
  </div>
</div>
