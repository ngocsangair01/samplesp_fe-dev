<div class="card-form">
    <div class="clearfix">
      <div class="left-nav-bar pull-left row-header">
        <div>
          <img alt="back" class="img-fluid" src="./../../../../../../assets/images/home/Mask_Group_18824.png" (click)="goBack();">
          <span *ngIf="isView" class="title" translate>handleLetterDenunciation.title.view</span>
          <span *ngIf="isInsert" class="title" translate>handleLetterDenunciation.title.add</span>
          <span *ngIf="isUpdate" class="title" translate>handleLetterDenunciation.title.edit</span>
        </div>
      </div>
      <div class="right-nav-bar pull-right left-option">
          <ul class="header-right sys-ul space-line">
            <li>
              <button class="btn btn-sm vt-btn mt-btn ng-star-inserted" type="button" (click)="goBack();" [innerHTML]="'common.button.out' | translate">
              </button>
            </li>
            <li *ngIf="!isView">
              <button class="btn btn-sm vt-btn btn-submit mt-btn ng-star-inserted" type="button" (click)="processSaveOrUpdate()" [innerHTML]="'common.button.icon.save' | translate">
              </button>
            </li>
          </ul>
      </div>
    </div>
</div>
<div class="info">
    <div
        *ngIf="(hasPermission('action.view') && isView) || (hasPermission('action.update') && isUpdate) || (hasPermission('action.insert') && isInsert)">
        <div class="panel panel-default card-info">
            <div class="panel-heading vt-relative">
                <strong>
                    <!-- <span *ngIf="isView" translate>handleLetterDenunciation.title.view</span>
                    <span *ngIf="isInsert" translate>handleLetterDenunciation.title.add</span>
                    <span *ngIf="isUpdate" translate>handleLetterDenunciation.title.edit</span> -->
                    <span class="ml-2 title-info">Thông tin chi tiết</span>
                </strong>
                <div *ngIf="!isView" class="vt-absolute vt-shotcut-button-in-heading">
                    <button type="button" (click)="refresh()" class="btn btn-sm vt-btn btn-submit"
                        [innerHTML]="'common.button.icon.refresh' | translate"></button>
                </div>
            </div>
            <div class="panel-body padding-xl ui-g">
                <form id="formSave" [formGroup]="formSave">
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{ 'letterDenunciation.label.code' | translate }}:
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3 control-label">
                            {{ f['code'].value }}
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{ 'letterDenunciation.label.type' | translate }}:
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3 control-label">
                            {{ 'letterDenunciation.type.' + f['type'].value | translate }}
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{ 'letterDenunciation.label.name' | translate }}:
    
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3 control-label">
                            {{ f['name'].value }}
                        </div>
                        <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                            {{ 'letterDenunciation.label.dateOfReception' | translate }}:
                        </label>
                        <div class="ui-g-12 ui-md-6 ui-lg-3 control-label">
                            {{ f['dateOfReception'].value | displayDate }}
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-3 ui-lg-2 control-label vt-align-right">
                            {{ 'common.label.attachmentFile' | translate }}
                        </label>
                        <div class="ui-g-12 ui-md-9 ui-lg-3">
                            <multi-file-chooser [property]="f['files']" fileName="fileAttachment" validMaxSize="50"
                                validType="png,jpg,gif,tiff,bmp,xls,xlsx,doc,docx,pdf,rar,zip,7z" disabled="true"
                                downLoadFile="true">
                            </multi-file-chooser>
                        </div>
                    </div>
                    <div class="ui-g-12 vt-row">
                        <label class="ui-g-12 ui-md-3 ui-lg-2 control-label vt-align-right">
                            {{ 'letterDenunciation.label.type' + f['type'].value | translate }}
                        </label>
                        <div class="ui-g-12 ui-md-9 ui-lg-8">
                            <multi-data-picker
                                *ngIf="f['type'].value === types[0].value || f['type'].value === types[2].value"
                                [property]="f['employeeIds']" systemCode="political" operationKey="action.view"
                                adResourceKey="resource.receiveLetterDenunciation" objectBO="EmployeeBO"
                                codeField="employeeCode" nameField="fullName" emailField="email" selectField="employeeId"
                                isSearchByPartyDomainData="true" filterCondition="AND obj.status = 1" disabled="true">
                            </multi-data-picker>
    
                            <multi-party-org-selector
                                *ngIf="f['type'].value === types[1].value || f['type'].value === types[3].value"
                                [property]="f['partyOrganizationIds']" operationKey="action.view"
                                adResourceKey="resource.receiveLetterDenunciation" disabled="true">
                            </multi-party-org-selector>
                        </div>
                    </div>
                    <div *ngIf="!isView">
                        <div class="ui-g-12 vt-row">
                            <label class="ui-g-12 ui-md-3 ui-lg-2 control-label vt-align-right"
                                [ngClass]="isView?'':'required'">
                                {{ 'handleLetterDenunciation.label.recommendation' | translate }}
                            </label>
                            <div class="ui-g-12 ui-md-9 ui-lg-8">
                                <textarea type="text" rows="3" name="recommendation" class="form-control"
                                    formControlName="recommendation" maxlength="500" [disabled]="isView">
                        </textarea>
                                <app-control-messages [control]="f['recommendation']"></app-control-messages>
                            </div>
                        </div>
                        <div class="ui-g-12 vt-row">
                            <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                                [ngClass]="isView?'':'required'">
                                {{ 'handleLetterDenunciation.label.settlementDate' | translate }}
                            </label>
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <date-picker [property]="f['settlementDate']" [disabled]="isView"
                                    (onChanged)="checkFinalResult()"></date-picker>
                                <app-control-messages [control]="f['settlementDate']"></app-control-messages>
                            </div>
                            <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                                [ngClass]="isView?'':'required'">
                                {{ 'handleLetterDenunciation.label.partyOrganization' | translate }}
                            </label>
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <party-org-selector [property]="f['partyOrganizationId']" operationKey="action.view"
                                    adResourceKey="resource.handlePartyLetterDenunciation" [disabled]="isView"
                                    isRequiredField="true" (onChange)="checkExistedPartyOrganization()">
                                </party-org-selector>
                                <app-control-messages [control]="f['partyOrganizationId']"></app-control-messages>
                            </div>
                        </div>
                        <div class="ui-g-12 vt-row">
                            <label class="ui-g-12 ui-md-3 ui-lg-2 control-label vt-align-right"
                                [ngClass]="isView?'':'required'">
                                {{ 'handleLetterDenunciation.label.settlementResult' | translate }}
                            </label>
                            <div class="ui-g-12 ui-md-9 ui-lg-8">
                                <textarea type="text" rows="3" name="settlementResult" class="form-control"
                                    formControlName="settlementResult" maxlength="500" [disabled]="isView">
                        </textarea>
                                <app-control-messages [control]="f['settlementResult']"></app-control-messages>
                            </div>
                        </div>
                        <div class="ui-g-12 vt-row">
                            <label class="ui-g-12 ui-md-3 ui-lg-2 control-label vt-align-right">
                                {{ 'handleLetterDenunciation.label.isFinalResult' | translate }}
                            </label>
                            <div class="ui-g-12 ui-md-9 ui-lg-8">
                                <div class="form-check">
                                    <label class="i-checks">
                                        <input type="checkbox" name="isFinalResult" [value]="1"
                                            formControlName="isFinalResult"
                                            [attr.disabled]="isView ? true : null || isFinalResult ? null : true" />
                                        <i></i>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading vt-relative">
                <strong>
                    <span class="ml-2 title-info">{{ 'handleLetterDenunciation.title.result' | translate }}</span>
                </strong>
            </div>
            <div class="panel-body panel-table" style="padding: 16px;">
                <p-table [scrollable]="true" [value]="handlingLetterDenunciations"
                    tableStyleClass="table controls-table table-wrapper b-t b-b"
                    [resizableColumns]="true">
                    <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                            <col style="width: 50px;">
                            <col style="width: 50px;">
                            <col style="width: 200px;">
                            <col style="width: 100px;">
                            <col style="width: 200px;">
                            <col style="width: 200px;">
                            <col style="width: 200px;">
                        </colgroup>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th translate pResizableColumn></th>
                            <th translate pResizableColumn>common.table.index</th>
                            <th *ngIf="hasPermission('action.update') && !isView" translate pResizableColumn>common.label.edit</th>
                            <th *ngIf="hasPermission('action.delete') && !isView" translate pResizableColumn>common.label.delete</th>
                            <th translate pResizableColumn>handleLetterDenunciation.label.recommendation</th>
                            <th translate pResizableColumn>handleLetterDenunciation.label.settlementDate</th>
                            <th translate pResizableColumn>handleLetterDenunciation.label.partyOrganization</th>
                            <th translate pResizableColumn>handleLetterDenunciation.label.settlementResult</th>
                            <th translate pResizableColumn>handleLetterDenunciation.label.isFinalResult</th>
                        </tr>
                    </ng-template>
    
                    <ng-template pTemplate="body" let-item let-index="rowIndex">
                        <tr>
                            <td class="vt-align-center" style="overflow: initial !important;">
                                <div ngbDropdown class="d-inline-block">
                                    <div ngbDropdownToggle class="vt-action-hover">
                                        <img class="menu-icon" src="./../../../assets/images/home/Icon.svg">
                                    </div>
                                    <div ngbDropdownMenu class="vt-border-radius">
                                      <!-- Sửa -->
                                      <button *ngIf="hasPermission('action.update') && !isView" class="dropdown-item"
                                              (click)="prepareUpdate(item.handlingLetterDenunciationId)"
                                              [innerHTML]="'common.button.table.acteditdropdown' | translate">
                                      </button>
                                      <!-- Xóa -->
                                      <button *ngIf="hasPermission('action.delete') && !isView" class="dropdown-item"
                                              (click)="delete(item.handlingLetterDenunciationId)"
                                              [innerHTML]="'common.button.icon.delete' | translate">
                                      </button>
                                    </div>
                                </div>
                            </td>
                            <td class="vt-align-center">{{index+1}}</td>
                            <td class="vt-align-left">{{item.recommendation}}</td>
                            <td class="vt-align-center">{{item.settlementDate | displayDate}}</td>
                            <td class="vt-align-left">{{item.partyOrganizationName}}</td>
                            <td class="vt-align-left">{{item.settlementResult}}</td>
                            <td class="vt-align-center">
                                <i *ngIf="item.isFinalResult === 1" class="fas fa-check table-icon color-info"></i>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
    <div
        *ngIf="(!hasPermission('action.view') && isView) || (!hasPermission('action.update') && isUpdate) || (!hasPermission('action.insert') && isInsert)">
        {{'common.haveNoPermission' | translate}}
    </div>
</div>