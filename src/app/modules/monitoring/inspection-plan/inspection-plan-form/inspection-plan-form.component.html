<div
    *ngIf="(hasPermission('action.view') && isView) || (hasPermission('action.update') && isUpdate) || (hasPermission('action.insert') && isInsert)">
    <div class="panel panel-default">
        <div class="panel-heading vt-relative">
            <strong class="text-u-c">
                <i class="fa fa-th"></i>&nbsp;
                <span *ngIf="isView" translate>inspectionPlan.title.viewInspectionPlan</span>
                <span *ngIf="isInsert" translate>inspectionPlan.title.addInspectionPlan</span>
                <span *ngIf="isUpdate" translate>inspectionPlan.title.editInspectionPlan</span>
            </strong>
        </div>
        <div class="panel-body padding-xl ui-g">
            <form id="formSave" [formGroup]="formSave">
                <div class="ui-g-12 vt-row">
                    <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'inspectionPlan.label.inspectionPlanCode' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <input type="text" class="form form-control" [attr.disabled]="true" name="inspectionPlanCode"
                            formControlName="inspectionPlanCode" maxlength="50" />
                        <app-control-messages [control]="f['inspectionPlanCode']"></app-control-messages>
                    </div>
                </div>
                <div class="ui-g-12 vt-row">
                    <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'inspectionPlan.label.inspectionPlanName' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-9">
                        <input type="text" class="form form-control" name="inspectionPlanName"
                            formControlName="inspectionPlanName" [attr.disabled]="isView?true:null" maxlength="200"
                            [autoFocus]="true" />
                        <app-control-messages [control]="f['inspectionPlanName']"></app-control-messages>
                    </div>
                </div>
                <div class="ui-g-12 vt-row">
                    <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'label.inspect.party.organization' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <party-org-selector [property]="f['partyOrganizationId']" operationKey="action.view"
                            adResourceKey="resource.inspectionPlan" [disabled]="isView" isRequiredField="true"
                            (onChange)="generateCode()">
                        </party-org-selector>
                        <app-control-messages [control]="f['partyOrganizationId']"></app-control-messages>
                    </div>
                    <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'inspectionPlan.label.promulgateName' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <input type="text" class="form form-control" formControlName="promulgateName"
                            [attr.disabled]="isView?true:null" maxlength="200">
                        <app-control-messages [control]="f['promulgateName']"></app-control-messages>
                    </div>
                </div>
                <div class="ui-g-12 vt-row">
                    <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'inspectionPlan.label.documentNumber' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <input type="text" class="form form-control" formControlName="documentNumber"
                            [attr.disabled]="isView?true:null" maxlength="50">
                        <app-control-messages [control]="f['documentNumber']"></app-control-messages>
                    </div>
                    <label class="ui-g-12 ui-md-6 ui-lg-3 control-label vt-align-right"
                        [ngClass]="isView?'':'required'">
                        {{ 'inspectionPlan.label.promulgateDate' | translate }}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <date-picker [property]="f['promulgateDate']" [disabled]="isView" (onChanged)="generateCode()">
                        </date-picker>
                        <app-control-messages [control]="f['promulgateDate']"></app-control-messages>
                    </div>
                </div>
                <div class="ui-g-12 vt-row">
                    <label class="ui-g-12 ui-md-2 control-label vt-align-right">
                        {{'common.label.attachmentFile' | translate}}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <multi-file-chooser [property]="f['files']" fileName="fileAttachment" validMaxSize="50"
                            validType="png,jpg,gif,tiff,bmp,xls,xlsx,doc,docx,pdf,rar,zip,7z" [disabled]="isView"
                            downLoadFile="true">
                        </multi-file-chooser>
                        <app-control-messages [control]="f['files']"></app-control-messages>
                    </div>
                </div>
                <div class="ui-g-12 vt-row" *ngIf="!isView">
                    <label class="ui-g-12 ui-md-6 ui-lg-2 control-label vt-align-right">
                        {{'inspectionPlan.title.listInspectionPlanDetails' | translate}}
                    </label>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">
                        <file-chooser [property]="f['fileImport']" [validMaxSize]="50" validType="xls"
                            (onFileChange)="readFileImport()" [disabled]="isView">
                        </file-chooser>
                        <br>
                        <a class="text-link" [hidden]="isView" (click)="processDownloadTemplate();">
                            <span translate><i class="fa fa-download"></i> app.common.downloadTemplate</span>
                        </a>
                        <br>
                        <i style="color: red;">{{'inspectionPlanDetails.importNotification' | translate}}</i>
                        <app-control-messages [control]="f['fileImport']"></app-control-messages>
                    </div>
                </div>
            </form>
        </div>
        <div class="panel-footer vt-area-button">
            <button *ngIf="isView==false" type="submit" (click)="processSaveOrUpdate()" class="btn btn-sm btn-info"
                [innerHTML]="'common.button.icon.save' | translate"></button>
            <button type="button" (click)="goBack()" class="btn btn-sm btn-danger"
                [innerHTML]="'common.button.out' | translate"></button>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading vt-relative">
            <strong class="text-u-c">
                <i class="fa fa-th"></i>
                &nbsp;{{ 'inspectionPlan.title.listInspectionPlanDetails' | translate }}
            </strong>
        </div>
        <div class="panel-body panel-table">
            <form id="formDetails" [formGroup]="formDetails">
                <p-table [scrollable]="true" [value]="formDetails.controls"
                    tableStyleClass="table controls-table table-wrapper b-t b-b">
                    <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                            <col class="size-1">
                            <col class="size-12">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-1">
                            <col class="size-10">
                            <col class="size-12">
                            <col class="size-8">
                            <col *ngIf="!isView" class="size-4">
                        </colgroup>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th translate>common.table.index</th>
                            <th translate><span [ngClass]="isView?'':'required'">common.label.content</span></th>
                            <th translate>inspectionPlanDetails.label.workScheduleJan</th>
                            <th translate>inspectionPlanDetails.label.workScheduleFeb</th>
                            <th translate>inspectionPlanDetails.label.workScheduleMar</th>
                            <th translate>inspectionPlanDetails.label.workScheduleApr</th>
                            <th translate>inspectionPlanDetails.label.workScheduleMay</th>
                            <th translate>inspectionPlanDetails.label.workScheduleJun</th>
                            <th translate>inspectionPlanDetails.label.workScheduleJul</th>
                            <th translate>inspectionPlanDetails.label.workScheduleAug</th>
                            <th translate>inspectionPlanDetails.label.workScheduleSep</th>
                            <th translate>inspectionPlanDetails.label.workScheduleOct</th>
                            <th translate>inspectionPlanDetails.label.workScheduleNov</th>
                            <th translate>inspectionPlanDetails.label.workScheduleDec</th>
                            <th translate>
                                <span [ngClass]="isView?'':'required'">inspectionPlanDetails.label.host</span>
                            </th>
                            <th translate>
                                <span
                                    [ngClass]="isView?'':'required'">inspectionPlanDetails.label.implementingAgency</span>
                            </th>
                            <th translate>common.label.note</th>
                            <th *ngIf="!isView" translate>common.label.action</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-item let-index="rowIndex">
                        <tr [formGroup]="item"
                            [ngClass]="{'bg-highlight-error': item.controls.isDuplicated.value === true}">
                            <td class="vt-align-center">
                                {{index+1}}
                            </td>
                            <td>
                                <select-filter [property]="item.controls.taskGroupId" [options]="taskGroupIds"
                                    optionLabel="name" optionValue="categoryId" placeHolder="common.label.cboMustSelect"
                                    [disabled]="isView" appendTo="body" (onChange)="checkDuplicated(item)">
                                </select-filter>
                                <app-control-messages [control]="item.controls.taskGroupId"></app-control-messages>
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleJan"
                                    [attr.disabled]="isView?true:null" />
                                <app-control-messages [control]="item.controls.workScheduleJan"></app-control-messages>
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleFeb"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleMar"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleApr"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleMay"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleJun"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleJul"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleAug"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleSep"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleOct"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleNov"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td class="vt-align-center">
                                <input type="checkbox" [value]="1" formControlName="workScheduleDec"
                                    [attr.disabled]="isView?true:null" />
                            </td>
                            <td>
                                <data-picker [property]="item.controls.employeeId" systemCode="political"
                                    operationKey="action.view" adResourceKey="resource.inspectionPlan"
                                    objectBO="EmployeeBO" codeField="employeeCode" nameField="fullName"
                                    emailField="email" selectField="employeeId" mobileNumberField="mobileNumber"
                                    [filterCondition]="employeeFilterCondition" isNotSearchByOrgDomainData="true"
                                    isRequiredField="true" [disabled]="isView">
                                </data-picker>
                                <app-control-messages [control]="item.controls.employeeId"></app-control-messages>
                            </td>
                            <td>
                                <party-org-selector [property]="item.controls.partyOrganizationId"
                                    operationKey="action.view" adResourceKey="resource.inspectionPlan"
                                    isRequiredField="true" [disabled]="isView" (onChange)="checkDuplicated(item)">
                                </party-org-selector>
                                <app-control-messages [control]="item.controls.partyOrganizationId">
                                </app-control-messages>
                            </td>
                            <td>
                                <textarea formControlName="note" name="note" class="form-control" maxlength="1000"
                                    [attr.disabled]="isView?true:null"></textarea>
                                <app-control-messages [control]="item.controls.note"></app-control-messages>
                            </td>
                            <td *ngIf="!isView" class="vt-align-center">
                                <button class="btn-icon plus" type="button" (click)="addRow(index)"
                                    [innerHTML]="'common.icon.plus' | translate">
                                </button>
                                <button class="btn-icon minus" type="button" (click)="removeRow(index)"
                                    [innerHTML]="'common.icon.minus' | translate">
                                </button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </form>
        </div>
    </div>
    <div *ngIf="dataError">
        <import-error [data]="dataError"></import-error>
    </div>
</div>
<div
    *ngIf="(!hasPermission('action.view') && isView) || (!hasPermission('action.update') && isUpdate) || (!hasPermission('action.insert') && isInsert)">
    {{'common.haveNoPermission' | translate}}
</div>